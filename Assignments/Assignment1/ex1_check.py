import time

import ex1
import search


def run_problem(func, targs=(), kwargs=None):
    if kwargs is None:
        kwargs = {}
    result = (-3, "default")
    try:
        result = func(*targs, **kwargs)

    except Exception as e:
        result = (-3, e)
    return result


# check_problem: problem, search_method, timeout
# timeout_exec: search_method, targs=[problem], timeout_duration=timeout
def solve_problems(problem, algorithm):
    print("-----------------------------------") 
    print("Problem:")
    print("Grid:")
    print(problem["grid"])
    print("Total Water:", problem["total_water"])  
    print("Agent Capacities", problem["agent_capacities"])  
    print("Goals", problem["goals"])  
    print("-----------------------------------")

    try:
        p = ex1.create_watering_problem(problem)
    except Exception as e:
        print("Error creating problem: ", e)
        return None

    if algorithm == "gbfs":
        result = run_problem((lambda p: search.greedy_best_first_graph_search(p, p.h_gbfs)),targs=[p])
    else:
        result = run_problem((lambda p: search.astar_search(p, p.h_astar)), targs=[p])

    if result and isinstance(result[0], search.Node):
        solve = result[0].path()[::-1]
        solution = [pi.action for pi in solve][1:]
        print(len(solution), solution)
    else:
        print("no solution")


grid1 = [
    # Row 0
    [(0,50,50,50,50), (0,50,50,50,80), (0,50,50,80,50), (0,80,50,50,80), (21,50,50,50,50), (0,50,50,50,80), (0,50,50,50,80)],
    # Row 1
    [(0,50,50,80,50), (11,80,80,50,50), (0,50,50,50,50), (0,50,80,80,50), (0,80,50,50,50), (0,50,80,80,50), (0,80,80,50,50)],
    # Row 2
    [(0,50,50,80,50), (0,80,50,80,50), (101,80,50,50,80), (0,50,50,50,50), (0,50,50,50,80), (22,50,50,80,80), (0,80,50,50,50)],
    # Row 3
    [(23,50,50,50,50), (0,50,50,50,50), (0,50,80,80,50), (12,80,50,50,50), (0,50,80,80,50), (0,80,80,50,50), (0,50,50,50,50)],
    # Row 4
    [(0,50,50,50,80), (0,50,50,50,50), (0,50,50,80,50), (0,80,50,50,80), (102,50,50,80,50), (0,80,50,50,80), (0,50,50,50,50)],
    # Row 5
    [(0,50,80,80,50), (0,80,50,50,50), (0,50,50,50,50), (0,50,80,50,50), (0,50,50,50,50), (0,50,80,80,50), (0,80,50,50,50)],
    # Row 6
    [(0,50,50,50,50), (0,50,50,50,50), (0,50,50,50,50), (0,50,50,50,50), (0,50,50,50,50), (0,50,50,50,50), (0,50,50,50,50)]
]

problem1 = {
    "grid": grid1,
    "total_water": 40,
    "agent_capacities": { "11": 10, "12": 12 },
    "goals": { "21": 3, "22": 4, "23": 5 }
}
grid11 = [
    # Row 0
    [(0,50,50,50,50), (0,50,50,50,80), (0,50,50,80,50), (0,80,50,50,80), (21,50,50,50,50), (0,50,50,50,80), (0,50,50,50,80)],
    # Row 1
    [(0,50,50,80,50), (11,80,80,50,50), (0,50,50,50,50), (0,50,80,80,50), (0,80,50,50,50), (0,50,80,80,50), (0,80,80,50,50)],
    # Row 2
    [(0,50,50,80,50), (0,80,50,80,50), (101,80,50,50,80), (0,50,50,50,50), (0,50,50,50,80), (22,50,50,80,80), (0,80,50,50,50)],
    # Row 3
    [(23,50,50,50,50), (0,50,50,50,50), (0,50,80,80,50), (12,80,50,50,50), (0,50,80,80,50), (0,80,80,50,50), (0,50,50,50,50)],
    # Row 4
    [(24,50,50,50,80), (0,50,50,50,50), (0,50,50,80,50), (0,80,50,50,80), (102,50,50,80,50), (0,80,50,50,80), (0,50,50,50,50)],
    # Row 5
    [(0,50,80,80,50), (0,80,50,50,50), (0,50,50,50,50), (0,50,80,50,50), (0,50,50,50,50), (0,50,80,80,50), (25,80,50,50,50)],
    # Row 6
    [(0,50,50,50,50), (0,50,50,50,50), (0,50,50,50,50), (0,50,50,50,50), (0,50,50,50,50), (0,50,50,50,50), (0,50,50,50,50)]
]

problem11 = {
    "grid": grid11,
    "total_water": 40,
    "agent_capacities": { "11": 10, "12": 12 },
    "goals": { "21": 3, "22": 4, "23": 5,"24": 5,"25": 3 }
}
problem_easy = {
    "grid": [
        # r=0
        [(0,80,80,50,50), (100,50,50,50,50), (0,50,80,80,50)],
        # r=1
        [(11,80,50,50,50), (12,50,50,50,50), (0,80,50,80,50)],
        # r=2
        [(0,80,50,50,80), (21,50,50,50,50), (0,50,50,80,80)],
    ],
    "total_water": 80,
    "agent_capacities": { "11": 5,"12":5 },
    "goals": { "21": 9 }   # plant 21 needs 4 units
}

problem2 = {
    "grid": [
        # r=0
        [(0,80,80,50,50), (100,50,80,50,80), (0,50,80,80,50)],
        # r=1
        [(11,80,50,50,50), (0,50,80,80,50), (0,80,50,80,50)],
        # r=2
        [(0,80,50,50,80), (0,50,50,50,80), (21,50,50,80,80)],
    ],
    "total_water": 80,
    "agent_capacities": { "11": 5 },
    "goals": { "21": 9 }   # plant 21 needs 4 units
}

problem_check = {
    "grid": [
        # r=0
        [(0,80,80,50,50), (100,80,80,80,50), (0,50,80,80,50)],
        # r=1
        [(0,80,80,50,80), (11,50,50,80,80), (0,80,50,80,50)],
        # r=2
        [(0,80,50,50,80), (0,50,50,50,80), (21,50,50,80,80)],
    ],
    "total_water": 6,
    "agent_capacities": { "11": 5 },
    "goals": { "21": 4 }   # plant 21 needs 4 units
}


problem3 = {
    "grid": [
        # r=0
        [(0,80,80,50,50), (101,50,80,50,50), (0,50,80,50,80), (0,50,80,50,50), (21,50,80,80,50)],
        # r=1
        [(11,80,50,50,50), (0,50,50,50,50), (0,50,80,50,80), (0,50,50,80,50), (0,80,50,80,50)],
        # r=2
        [(0,80,50,50,50), (0,50,50,80,50), (0,80,80,50,80), (0,50,50,50,50), (0,50,50,80,50)],
        # r=3
        [(0,80,50,50,50), (0,50,50,50,50), (12,50,80,50,50), (0,50,50,50,80), (102,50,50,80,50)],
        # r=4
        [(0,80,50,50,80), (0,50,50,50,80), (0,50,50,50,80), (22,50,80,50,80), (0,50,50,80,80)],
    ],
    "total_water": 20,
    "agent_capacities": { "11": 8, "12": 10 },
    "goals": { "21": 6, "22": 7 }
}




def main():
    start = time.time()
    problem = [problem11]
    for p in problem:
        for a in ['astar']:
            solve_problems(p, a)
    end = time.time()
    print('Submission took:', end-start, 'seconds.')


if __name__ == '__main__':
    main()
